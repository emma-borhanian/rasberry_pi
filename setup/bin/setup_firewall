#!/bin/bash
set -e

source "$HOME/setup/lib/bash_include"

IPTABLES_FILE="$HOME/setup/iptables.rules"
PREUP_IPTABLES_FILE=/etc/network/if-pre-up.d/iptables

echo "configuring firewall"
if [[ ! -f "$PREUP_IPTABLES_FILE" ]]; then
  echo "#!/bin/sh" > "$PREUP_IPTABLES_FILE"
fi
chmod +x "$PREUP_IPTABLES_FILE"
if ! grep "^iptables-restore < \"$IPTABLES_FILE\"$" "$PREUP_IPTABLES_FILE" > /dev/null; then
  echo "iptables-restore < \"$IPTABLES_FILE\"" >> "$PREUP_IPTABLES_FILE"
fi
iptables-restore < "$IPTABLES_FILE"
